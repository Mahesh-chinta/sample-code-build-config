# try 1
# steps:
# - name: 'gcr.io/cloud-builders/go'
#   entrypoint: 'bash'
#   args:
#   - '-c'
#   - |
#     export GOPATH=/workspace/sample-code-build-config
#     go build -o myprogram
# ERROR
# ERROR: build step 0 "gcr.io/cloud-builders/go" failed: starting step container failed: Error response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: "bash": executable file not found in $PATH: unknown


#try 2
steps:
- name: 'gcr.io/cloud-builders/go'
  entrypoint: 'sh'
  args:
  - '-c'
  - |
    export GOPATH=/workspace/sample-code-build-config
    go build -o myprogram
# running the build
- name: 'gcr.io/cloud-builders/go'
  entrypoint: 'sh'
  args:
  - '-c'
  - |
    ./myprogram
    
# store the build
- name: 'gcr.io/cloud-builders/gsutil'
  args: ['cp', 'myprogram', 'gs://binary_storage/']
  
# upload the build
- name: 'gcr.io/cloud-builders/gcloud'
  args:
  - 'artifacts'
  - 'generic'
  - 'upload'
  - '--project=jio-big-data-poc'
  - '--location= asia-south1'
  - '--substitutions=_BUCKET=binary_storage'
  - 'myprogram'
